dat.trt$yeargrouping,margin=2,single=F,ron=2,col.names=T, summary.stat='mean')[,c(1,3:6)]
source('S:/Shared Material/Shared Code/R/temp_table1.R')
#source('C:/Users/campbkri/Documents/GitHub/BDC-Code/Gerard Gonzalez/00_data.R')
#Table 1A:
tab.1a<-final_table(dat.trt,c('a1c_last_in_year'),
dat.trt$yeargrouping,margin=2,single=F,ron=2,col.names=T, summary.stat='mean')[,c(1,3:6)]
colnames(tab.1a)<-c('Variable','Baseline','Year1','Year2','Year3')
n_row_1a<-data.frame(Variable="n",Baseline=nrow(subset(dat.trt,dat.trt$yeargrouping=="Base1" & !is.na(dat.trt$a1c_last_in_year))),
Year1=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year1" & !is.na(dat.trt$a1c_last_in_year))),
Year2=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year2" & !is.na(dat.trt$a1c_last_in_year))),
Year3=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year3" & !is.na(dat.trt$a1c_last_in_year))))
levels(tab.1a$Baseline)<-c(levels(tab.1a$Baseline),n_row_1a$Baseline)
levels(tab.1a$Year1)<-c(levels(tab.1a$Year1),n_row_1a$Year1)
levels(tab.1a$Year2)<-c(levels(tab.1a$Year2),n_row_1a$Year2)
levels(tab.1a$Year3)<-c(levels(tab.1a$Year3),n_row_1a$Year3)
tab.1a<-rbind(tab.1a,n_row_1a)
tab.1a.2<-final_table(dat.trt,c('checks_last_in_year'),
dat.trt$yeargrouping,margin=2,single=F,ron=2,col.names=T, summary.stat='mean')[,c(1,3:6)]
colnames(tab.1a.2)<-c('Variable','Baseline','Year1','Year2','Year3')
n_row_1a.c<-data.frame(Variable="n",Baseline=nrow(subset(dat.trt,dat.trt$yeargrouping=="Base1" & !is.na(dat.trt$checks_last_in_year))),
Year1=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year1" & !is.na(dat.trt$checks_last_in_year))),
Year2=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year2" & !is.na(dat.trt$checks_last_in_year))),
Year3=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year3" & !is.na(dat.trt$checks_last_in_year))))
levels(tab.1a.2$Baseline)<-c(levels(tab.1a.2$Baseline),n_row_1a.c$Baseline)
levels(tab.1a.2$Year1)<-c(levels(tab.1a.2$Year1),n_row_1a.c$Year1)
levels(tab.1a.2$Year2)<-c(levels(tab.1a.2$Year2),n_row_1a.c$Year2)
levels(tab.1a.2$Year3)<-c(levels(tab.1a.2$Year3),n_row_1a.c$Year3)
tab.1a.2<-rbind(tab.1a.2,n_row_1a.c)
tab.1a<-rbind(tab.1a,tab.1a.2)
##repeat for controls:
tab.1b<-final_table(dat.con,c('a1c_last_in_year'),
dat.con$yeargrouping,margin=2,single=F,ron=2,col.names=T, summary.stat='mean')[,c(1,3:6)]
colnames(tab.1b)<-c('Variable','Baseline','Year1','Year2','Year3')
n_row_1b<-data.frame(Variable="n",Baseline=nrow(subset(dat.con,dat.con$yeargrouping=="Base1" & !is.na(dat.con$a1c_last_in_year))),
Year1=nrow(subset(dat.con,dat.con$yeargrouping=="Year1" & !is.na(dat.con$a1c_last_in_year))),
Year2=nrow(subset(dat.con,dat.con$yeargrouping=="Year2" & !is.na(dat.con$a1c_last_in_year))),
Year3=nrow(subset(dat.con,dat.con$yeargrouping=="Year3" & !is.na(dat.con$a1c_last_in_year))))
levels(tab.1b$Baseline)<-c(levels(tab.1b$Baseline),n_row_1b$Baseline)
levels(tab.1b$Year1)<-c(levels(tab.1b$Year1),n_row_1b$Year1)
levels(tab.1b$Year2)<-c(levels(tab.1b$Year2),n_row_1b$Year2)
levels(tab.1b$Year3)<-c(levels(tab.1b$Year3),n_row_1b$Year3)
tab.1b<-rbind(tab.1b,n_row_1b)
tab.1b.2<-final_table(dat.con,c('checks_last_in_year'),
dat.con$yeargrouping,margin=2,single=F,ron=2,col.names=T, summary.stat='mean')[,c(1,3:6)]
colnames(tab.1b.2)<-c('Variable','Baseline','Year1','Year2','Year3')
n_row_1b.c<-data.frame(Variable="n",Baseline=nrow(subset(dat.con,dat.con$yeargrouping=="Base1" & !is.na(dat.con$checks_last_in_year))),
Year1=nrow(subset(dat.con,dat.con$yeargrouping=="Year1" & !is.na(dat.con$checks_last_in_year))),
Year2=nrow(subset(dat.con,dat.con$yeargrouping=="Year2" & !is.na(dat.con$checks_last_in_year))),
Year3=nrow(subset(dat.con,dat.con$yeargrouping=="Year3" & !is.na(dat.con$checks_last_in_year))))
levels(tab.1b.2$Baseline)<-c(levels(tab.1b.2$Baseline),n_row_1b.c$Baseline)
levels(tab.1b.2$Year1)<-c(levels(tab.1b.2$Year1),n_row_1b.c$Year1)
levels(tab.1b.2$Year2)<-c(levels(tab.1b.2$Year2),n_row_1b.c$Year2)
levels(tab.1b.2$Year3)<-c(levels(tab.1b.2$Year3),n_row_1b.c$Year3)
tab.1b.2<-rbind(tab.1b.2,n_row_1b.c)
tab.1b<-rbind(tab.1b,tab.1b.2)
tab.1b
mean_sd_table<-function(x,year){
#x<-dat$a1c_last_in_year
#year<-"Year"
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.2<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.2<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.2<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.3<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.3<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.3<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
mean.4<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.4<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.4<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
#table for x
tab.x<-data.frame(
variable=c(paste0(year,": ",label(x)),"n","mean (std. dev)"),
ControlYoung=c("",n.1,paste0(round(mean.1,3)," ","(",round(sd.1,3),")")),
ControlOld=c("",n.2,paste0(round(mean.2,3)," ","(",round(sd.1,3),")")),
TrtYoung=c("",n.3,paste0(round(mean.3,3)," ","(",round(sd.1,3),")")),
TrtOld=c("",n.4,paste0(round(mean.4,3)," ","(",round(sd.1,3),")"))
)
return(tab.x)
}
a1c_base<-mean_sd_table(dat.temp$a1c_last_in_year,"Base1")
a1c_base<-mean_sd_table(dat.temp$a1c_last_in_year,"Base1")
x<-dat.temp$a1c_last_in_year
x<-'a1c_last_in_year'
year<-"Year"
year<-"Year1"
#x<-'a1c_last_in_year'
#year<-"Year1"
dat.temp<-subset(dat,dat$yeargrouping==year)
dat.temp
#x<-'a1c_last_in_year'
#year<-"Year1"
x<-paste0("dat.temp$",x)
x
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
x<-'a1c_last_in_year'
#x<-'a1c_last_in_year'
#year<-"Year1"
x<-dat.temp[,which(colnames(dat.temp)==x)]
x
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
mean.1
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.2<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.2<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.2<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.3<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.3<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.3<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
mean.4<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.4<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.4<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
#table for x
tab.x<-data.frame(
variable=c(paste0(year,": ",label(x)),"n","mean (std. dev)"),
ControlYoung=c("",n.1,paste0(round(mean.1,3)," ","(",round(sd.1,3),")")),
ControlOld=c("",n.2,paste0(round(mean.2,3)," ","(",round(sd.1,3),")")),
TrtYoung=c("",n.3,paste0(round(mean.3,3)," ","(",round(sd.1,3),")")),
TrtOld=c("",n.4,paste0(round(mean.4,3)," ","(",round(sd.1,3),")"))
)
return(tab.x)
tab.x
View(dat.temp)
a1c_base<-mean_sd_table('a1c_last_in_year',"Base1")
a1c_1<-mean_sd_table('a1c_last_in_year',"Year1")
a1c_2<-mean_sd_table('a1c_last_in_year',"Year2")
a1c_3<-mean_sd_table('a1c_last_in_year',"Year3")
checks_base<-mean_sd_table('checks_last_in_year',"Base1")
checks_1<-mean_sd_table('checks_last_in_year',"Year1")
checks_2<-mean_sd_table('checks_last_in_year',"Year2")
checks_3<-mean_sd_table('checks_last_in_year',"Year3")
tab.2<-rbind(a1c_base,a1c_1,a1c_2,a1c_3,checks_base,checks_1,checks_2,checks_3)
tab.2
mean_sd_table<-function(x,year){
#x<-'a1c_last_in_year'
#year<-"Year1"
x<-dat.temp[,which(colnames(dat.temp)==x)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.2<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.2<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.2<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.3<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.3<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.3<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
mean.4<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.4<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.4<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
#table for x
tab.x<-data.frame(
variable=c(paste0(year,": ",label(x)),"n","mean (std. dev)"),
ControlYoung=c("",n.1,paste0(round(mean.1,3)," ","(",round(sd.1,3),")")),
ControlOld=c("",n.2,paste0(round(mean.2,3)," ","(",round(sd.1,3),")")),
TrtYoung=c("",n.3,paste0(round(mean.3,3)," ","(",round(sd.1,3),")")),
TrtOld=c("",n.4,paste0(round(mean.4,3)," ","(",round(sd.1,3),")"))
)
return(tab.x)
}
a1c_base<-mean_sd_table('a1c_last_in_year',"Base1")
a1c_base
a1c_1<-mean_sd_table('a1c_last_in_year',"Year1")
a1c_1
a1c_2<-mean_sd_table('a1c_last_in_year',"Year2")
a1c_3<-mean_sd_table('a1c_last_in_year',"Year3")
a1c_2
a1c_3
x<-'a1c_last_in_year'
year<-"Year1"
#x<-'a1c_last_in_year'
#year<-"Year1"
x<-dat.temp[,which(colnames(dat.temp)==x)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.2<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.2<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.2<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.3<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.3<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.3<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
mean.4<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.4<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.4<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
#table for x
tab.x<-data.frame(
variable=c(paste0(year,": ",label(x)),"n","mean (std. dev)"),
ControlYoung=c("",n.1,paste0(round(mean.1,3)," ","(",round(sd.1,3),")")),
ControlOld=c("",n.2,paste0(round(mean.2,3)," ","(",round(sd.1,3),")")),
TrtYoung=c("",n.3,paste0(round(mean.3,3)," ","(",round(sd.1,3),")")),
TrtOld=c("",n.4,paste0(round(mean.4,3)," ","(",round(sd.1,3),")"))
)
a1c_1<-mean_sd_table('a1c_last_in_year',"Year1")
a1c_2<-mean_sd_table('a1c_last_in_year',"Year2")
year<-"Year2"
x<-dat.temp[,which(colnames(dat.temp)==x)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
x<-'a1c_last_in_year'
year<-"Year2"
#x<-'a1c_last_in_year'
#year<-"Year2"
x<-dat.temp[,which(colnames(dat.temp)==x)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.2<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.2<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.2<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.3<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.3<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.3<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
mean.4<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.4<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.4<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
#table for x
tab.x<-data.frame(
variable=c(paste0(year,": ",label(x)),"n","mean (std. dev)"),
ControlYoung=c("",n.1,paste0(round(mean.1,3)," ","(",round(sd.1,3),")")),
ControlOld=c("",n.2,paste0(round(mean.2,3)," ","(",round(sd.1,3),")")),
TrtYoung=c("",n.3,paste0(round(mean.3,3)," ","(",round(sd.1,3),")")),
TrtOld=c("",n.4,paste0(round(mean.4,3)," ","(",round(sd.1,3),")"))
)
a1c_2<-mean_sd_table('a1c_last_in_year',"Year2")
a1c_3<-mean_sd_table('a1c_last_in_year',"Year3")
year<-"Year3"
#x<-'a1c_last_in_year'
#year<-"Year3"
x<-dat.temp[,which(colnames(dat.temp)==x)]
dat.temp<-subset(dat,dat$yeargrouping==year)
x<-'a1c_last_in_year'
year<-"Year3"
#x<-'a1c_last_in_year'
#year<-"Year3"
x<-dat.temp[,which(colnames(dat.temp)==x)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.2<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.2<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.2<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
mean.3<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.3<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.3<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
mean.4<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.4<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
n.4<-nrow(subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP" &!is.na(x)))
#table for x
tab.x<-data.frame(
variable=c(paste0(year,": ",label(x)),"n","mean (std. dev)"),
ControlYoung=c("",n.1,paste0(round(mean.1,3)," ","(",round(sd.1,3),")")),
ControlOld=c("",n.2,paste0(round(mean.2,3)," ","(",round(sd.1,3),")")),
TrtYoung=c("",n.3,paste0(round(mean.3,3)," ","(",round(sd.1,3),")")),
TrtOld=c("",n.4,paste0(round(mean.4,3)," ","(",round(sd.1,3),")"))
)
return(tab.x)
a1c_3<-mean_sd_table('a1c_last_in_year',"Year3")
checks_base<-mean_sd_table('checks_last_in_year',"Base1")
checks_1<-mean_sd_table('checks_last_in_year',"Year1")
checks_base<-mean_sd_table('checks_last_in_year',"Base1")
x<-'checks_last_in_year'
year<-"Base1"
#x<-'checks_last_in_year'
#year<-"Base1"
x<-dat.temp[,which(colnames(dat.temp)==x)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" &!is.na(x)))
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control" & !is.na(x)))
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"))
n.1<-nrow(subset(n.1, !is.na(x)))
n.1
x<-'checks_last_in_year'
year<-"Base1"
x<-dat.temp[,which(colnames(dat.temp)==x)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
n.1<-nrow(subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"))
n.1
subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control")
temp.1<-subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control")
var<-'checks_last_in_year'
year<-"Base1"
#var<-'checks_last_in_year'
#year<-"Base1"
x<-dat.temp[,which(colnames(dat.temp)==var)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
temp.1<-subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control")
n.1<-nrow(subset(temp.1,!is.na(var)))
n.1
mean.2<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.2<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
temp.2<-subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control")
n.2<-nrow(subset(temp.2,!is.na(var)))
n.2
mean.3<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.3<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
temp.3<-subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP")
n.3<-nrow(subset(temp.3,!is.na(var)))
n.3
mean_sd_table<-function(var,year){
#var<-'checks_last_in_year'
#year<-"Base1"
x<-dat.temp[,which(colnames(dat.temp)==var)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
temp.1<-subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control")
n.1<-nrow(subset(temp.1,!is.na(var)))
mean.2<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.2<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
temp.2<-subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control")
n.2<-nrow(subset(temp.2,!is.na(var)))
mean.3<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.3<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
temp.3<-subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP")
n.3<-nrow(subset(temp.3,!is.na(var)))
mean.4<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.4<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
temp.4<-subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP")
n.4<-nrow(subset(temp.4,!is.na(var)))
#table for x
tab.x<-data.frame(
variable=c(paste0(year,": ",label(x)),"n","mean (std. dev)"),
ControlYoung=c("",n.1,paste0(round(mean.1,3)," ","(",round(sd.1,3),")")),
ControlOld=c("",n.2,paste0(round(mean.2,3)," ","(",round(sd.1,3),")")),
TrtYoung=c("",n.3,paste0(round(mean.3,3)," ","(",round(sd.1,3),")")),
TrtOld=c("",n.4,paste0(round(mean.4,3)," ","(",round(sd.1,3),")"))
)
return(tab.x)
}
a1c_base<-mean_sd_table('a1c_last_in_year',"Base1")
a1c_1<-mean_sd_table('a1c_last_in_year',"Year1")
a1c_2<-mean_sd_table('a1c_last_in_year',"Year2")
a1c_3<-mean_sd_table('a1c_last_in_year',"Year3")
checks_base<-mean_sd_table('checks_last_in_year',"Base1")
checks_1<-mean_sd_table('checks_last_in_year',"Year1")
checks_2<-mean_sd_table('checks_last_in_year',"Year2")
checks_3<-mean_sd_table('checks_last_in_year',"Year3")
tab.2<-rbind(a1c_base,a1c_1,a1c_2,a1c_3,checks_base,checks_1,checks_2,checks_3)
tab.2
setwd("C:/Users/campbkri/Documents/GitHub/BDC-Code/Gerard Gonzalez")
source('01_functions.R')
source('00_data.R')
setwd("C:/Users/campbkri/Documents/GitHub/BDC-Code/Gerard Gonzalez")
source('02_tables.R')
source('03_mixed.R')
setwd("C:/Users/campbkri/Documents/GitHub/BDC-Code/Gerard Gonzalez")
source('01_functions.R')
source('00_data.R')
source('02_tables.R')
source('03_mixed.R')
setwd("C:/Users/campbkri/Documents/GitHub/BDC-Code/Gerard Gonzalez")
source('01_functions.R')
source('00_data.R')
setwd("C:/Users/campbkri/Documents/GitHub/BDC-Code/Gerard Gonzalez")
source('02_tables.R')
source('03_mixed.R')
a1c_mod_toyear3<-lme(checks_last_in_year~baseline_a1c+factor(yeargrouping)+group+factor(trt_grp)+factor(yeargrouping)*factor(trt_grp)+duration_of_diagnosis
,random=~1|MRN/yeargrouping,data=dat_3)
checks_mod_toyear3<-lme(checks_last_in_year~baseline_a1c+factor(yeargrouping)+group+factor(trt_grp)+factor(yeargrouping)*factor(trt_grp)+duration_of_diagnosis
,random=~1|MRN/yeargrouping,data=dat_3)
checks_year3_sum<-summary(checks_mod_tochecks_year3)
checks_year3_sum
checks_mod_toyear3<-lme(checks_last_in_year~baseline_a1c+factor(yeargrouping)+group+factor(trt_grp)+factor(yeargrouping)*factor(trt_grp)+duration_of_diagnosis
,random=~1|MRN/yeargrouping,data=dat_3)
checks_year3_sum<-summary(checks_mod_tochecks_year3)
checks_year3_sum<-summary(checks_mod_to_year3)
checks_year3_sum
checks_mod_toyear3<-lme(checks_last_in_year~baseline_a1c+factor(yeargrouping)+group+factor(trt_grp)+factor(yeargrouping)*factor(trt_grp)+duration_of_diagnosis
,random=~1|MRN/yeargrouping,data=dat_3)
checks_year3_sum<-summary(checks_mod_toyear3)
checks_year3_sum
checks_year3_sum<-checks_year3_sum$tTable[,c(1,2,5)]
checks_year3_sum<-as.data.frame(checks_year3_sum)
checks_year3_sum$Value<-round(checks_year3_sum$Value,3)
checks_year3_sum$Std.Error<-round(checks_year3_sum$Std.Error,3)
checks_year3_sum$`p-value`<-round(checks_year3_sum$`p-value`,3)
checks_year3_sum
#test for differences between groups at each time point:
ref_3 <- lsmeans(checks_mod_toyear3, c("trt_grp", "yeargrouping"))
ref_3
#test for differences between groups at each time point:
ref_3_checks <- lsmeans(checks_mod_toyear3, c("trt_grp", "yeargrouping"))
c_list_3_checks <- list(c_base1 = c(0, 0, -1, 1, 0, 0, 0, 0),
c_year1 = c(0, 0, 0, 0, -1, 1, 0, 0),
c_year2 = c(0, 0, 0, 0, 0, 0, -1, 1),
c_year3 = c(-1, 1, 0, 0, 0, 0, 0, 0)
)
contrasts_3<-summary(contrast(ref_3_checks, c_list_3_checks))
contrasts_3<-contrasts_3[,c(1,2,3,6)]
contrasts_3$estimate<-round(contrasts_3$estimate,3)
contrasts_3$SE<-round(contrasts_3$SE,3)
contrasts_3$p.value<-round(contrasts_3$p.value,3)
contrasts_3
contrasts_3
##### Tables - Gerard Gonzalez #####
source('S:/Shared Material/Shared Code/R/temp_table1.R')
#source('C:/Users/campbkri/Documents/GitHub/BDC-Code/Gerard Gonzalez/00_data.R')
#Table 1A:
tab.1a<-final_table(dat.trt,c('a1c_last_in_year'),
dat.trt$yeargrouping,margin=2,single=F,ron=2,col.names=T, summary.stat='mean')[,c(1,3:6)]
colnames(tab.1a)<-c('Variable','Baseline','Year1','Year2','Year3')
n_row_1a<-data.frame(Variable="n",Baseline=nrow(subset(dat.trt,dat.trt$yeargrouping=="Base1" & !is.na(dat.trt$a1c_last_in_year))),
Year1=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year1" & !is.na(dat.trt$a1c_last_in_year))),
Year2=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year2" & !is.na(dat.trt$a1c_last_in_year))),
Year3=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year3" & !is.na(dat.trt$a1c_last_in_year))))
levels(tab.1a$Baseline)<-c(levels(tab.1a$Baseline),n_row_1a$Baseline)
levels(tab.1a$Year1)<-c(levels(tab.1a$Year1),n_row_1a$Year1)
levels(tab.1a$Year2)<-c(levels(tab.1a$Year2),n_row_1a$Year2)
levels(tab.1a$Year3)<-c(levels(tab.1a$Year3),n_row_1a$Year3)
tab.1a<-rbind(tab.1a,n_row_1a)
tab.1a.2<-final_table(dat.trt,c('checks_last_in_year'),
dat.trt$yeargrouping,margin=2,single=F,ron=2,col.names=T, summary.stat='mean')[,c(1,3:6)]
colnames(tab.1a.2)<-c('Variable','Baseline','Year1','Year2','Year3')
n_row_1a.c<-data.frame(Variable="n",Baseline=nrow(subset(dat.trt,dat.trt$yeargrouping=="Base1" & !is.na(dat.trt$checks_last_in_year))),
Year1=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year1" & !is.na(dat.trt$checks_last_in_year))),
Year2=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year2" & !is.na(dat.trt$checks_last_in_year))),
Year3=nrow(subset(dat.trt,dat.trt$yeargrouping=="Year3" & !is.na(dat.trt$checks_last_in_year))))
levels(tab.1a.2$Baseline)<-c(levels(tab.1a.2$Baseline),n_row_1a.c$Baseline)
levels(tab.1a.2$Year1)<-c(levels(tab.1a.2$Year1),n_row_1a.c$Year1)
levels(tab.1a.2$Year2)<-c(levels(tab.1a.2$Year2),n_row_1a.c$Year2)
levels(tab.1a.2$Year3)<-c(levels(tab.1a.2$Year3),n_row_1a.c$Year3)
tab.1a.2<-rbind(tab.1a.2,n_row_1a.c)
tab.1a<-rbind(tab.1a,tab.1a.2)
##repeat for controls:
tab.1b<-final_table(dat.con,c('a1c_last_in_year'),
dat.con$yeargrouping,margin=2,single=F,ron=2,col.names=T, summary.stat='mean')[,c(1,3:6)]
colnames(tab.1b)<-c('Variable','Baseline','Year1','Year2','Year3')
n_row_1b<-data.frame(Variable="n",Baseline=nrow(subset(dat.con,dat.con$yeargrouping=="Base1" & !is.na(dat.con$a1c_last_in_year))),
Year1=nrow(subset(dat.con,dat.con$yeargrouping=="Year1" & !is.na(dat.con$a1c_last_in_year))),
Year2=nrow(subset(dat.con,dat.con$yeargrouping=="Year2" & !is.na(dat.con$a1c_last_in_year))),
Year3=nrow(subset(dat.con,dat.con$yeargrouping=="Year3" & !is.na(dat.con$a1c_last_in_year))))
levels(tab.1b$Baseline)<-c(levels(tab.1b$Baseline),n_row_1b$Baseline)
levels(tab.1b$Year1)<-c(levels(tab.1b$Year1),n_row_1b$Year1)
levels(tab.1b$Year2)<-c(levels(tab.1b$Year2),n_row_1b$Year2)
levels(tab.1b$Year3)<-c(levels(tab.1b$Year3),n_row_1b$Year3)
tab.1b<-rbind(tab.1b,n_row_1b)
tab.1b.2<-final_table(dat.con,c('checks_last_in_year'),
dat.con$yeargrouping,margin=2,single=F,ron=2,col.names=T, summary.stat='mean')[,c(1,3:6)]
colnames(tab.1b.2)<-c('Variable','Baseline','Year1','Year2','Year3')
n_row_1b.c<-data.frame(Variable="n",Baseline=nrow(subset(dat.con,dat.con$yeargrouping=="Base1" & !is.na(dat.con$checks_last_in_year))),
Year1=nrow(subset(dat.con,dat.con$yeargrouping=="Year1" & !is.na(dat.con$checks_last_in_year))),
Year2=nrow(subset(dat.con,dat.con$yeargrouping=="Year2" & !is.na(dat.con$checks_last_in_year))),
Year3=nrow(subset(dat.con,dat.con$yeargrouping=="Year3" & !is.na(dat.con$checks_last_in_year))))
levels(tab.1b.2$Baseline)<-c(levels(tab.1b.2$Baseline),n_row_1b.c$Baseline)
levels(tab.1b.2$Year1)<-c(levels(tab.1b.2$Year1),n_row_1b.c$Year1)
levels(tab.1b.2$Year2)<-c(levels(tab.1b.2$Year2),n_row_1b.c$Year2)
levels(tab.1b.2$Year3)<-c(levels(tab.1b.2$Year3),n_row_1b.c$Year3)
tab.1b.2<-rbind(tab.1b.2,n_row_1b.c)
tab.1b<-rbind(tab.1b,tab.1b.2)
mean_sd_table<-function(var,year){
#var<-'checks_last_in_year'
#year<-"Base1"
x<-dat.temp[,which(colnames(dat.temp)==var)]
dat.temp<-subset(dat,dat$yeargrouping==year)
mean.1<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.1<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control"],na.rm=T)
temp.1<-subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="Control")
n.1<-nrow(subset(temp.1,!is.na(var)))
mean.2<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
sd.2<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control"],na.rm=T)
temp.2<-subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="Control")
n.2<-nrow(subset(temp.2,!is.na(var)))
mean.3<-mean(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.3<-sd(x[dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP"],na.rm=T)
temp.3<-subset(dat.temp,dat.temp$group=="Less than 12" & dat.temp$trt_grp=="LP")
n.3<-nrow(subset(temp.3,!is.na(var)))
mean.4<-mean(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
sd.4<-sd(x[dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP"],na.rm=T)
temp.4<-subset(dat.temp,dat.temp$group=="greater than or equal to 12" & dat.temp$trt_grp=="LP")
n.4<-nrow(subset(temp.4,!is.na(var)))
#table for x
tab.x<-data.frame(
variable=c(paste0(year,": ",label(x)),"n","mean (std. dev)"),
ControlYoung=c("",n.1,paste0(round(mean.1,3)," ","(",round(sd.1,3),")")),
ControlOld=c("",n.2,paste0(round(mean.2,3)," ","(",round(sd.1,3),")")),
TrtYoung=c("",n.3,paste0(round(mean.3,3)," ","(",round(sd.1,3),")")),
TrtOld=c("",n.4,paste0(round(mean.4,3)," ","(",round(sd.1,3),")"))
)
return(tab.x)
}
a1c_base<-mean_sd_table('a1c_last_in_year',"Base1")
a1c_1<-mean_sd_table('a1c_last_in_year',"Year1")
a1c_2<-mean_sd_table('a1c_last_in_year',"Year2")
a1c_3<-mean_sd_table('a1c_last_in_year',"Year3")
checks_base<-mean_sd_table('checks_last_in_year',"Base1")
checks_1<-mean_sd_table('checks_last_in_year',"Year1")
checks_2<-mean_sd_table('checks_last_in_year',"Year2")
checks_3<-mean_sd_table('checks_last_in_year',"Year3")
tab.2<-rbind(a1c_base,a1c_1,a1c_2,a1c_3,checks_base,checks_1,checks_2,checks_3)
setwd("C:/Users/campbkri/Documents/GitHub/BDC-Code/Gerard Gonzalez")
source('01_functions.R')
source('00_data.R')
setwd("C:/Users/campbkri/Documents/GitHub/BDC-Code/Gerard Gonzalez")
source('02_tables.R')
source('03_mixed.R')
