---
title: "670G 3 and 6 Month"
author: "Tim Vigers"
date: "5/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(lubridate)
```

```{r echo=FALSE}
# Read in dates
dates <- read.csv("/Volumes/som-1/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects/Janet Snell-Bergeon/670g CGM/Data_Cleaned/MASTER LIST FINAL.csv")
# Iterate through files
indir <- "/Volumes/som-1/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects/Janet Snell-Bergeon/670g CGM/Data_Raw/670g Files"
outdir <- "/Volumes/som-1/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects/Janet Snell-Bergeon/670g CGM/Data_Cleaned/Sensor Files"
files <- list.files(indir,full.names = T)
for (f in files) {
  dat <- read.csv(f,stringsAsFactors = F)
  id <- as.numeric(as.character(dat$Patient.ID[1]))
  sensorstart <- which(dat$Patient.ID=="Sensor") + 2
  colnames(dat) <- as.character(dat[(which(dat$Patient.ID=="Sensor")+1),])
  dat <- dat[sensorstart:nrow(dat),]
  dat$timestamp <- paste(dat$Date,dat$Time)
  dat$timestamp <- mdy_hms(dat$timestamp)
  dat$subjectid <- id
  colnames(dat)[which(colnames(dat) == "Sensor Glucose (mg/dL)")] <- "sensorglucose"
  dat <- dat[,c("subjectid","timestamp","sensorglucose")]
  filename <- paste0(outdir,"/",id,".csv")
  write.csv(dat,file = filename)
}
```