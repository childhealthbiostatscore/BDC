---
title: "670G Combined Analysis  "
author: "Tim Vigers & Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,dpi = 600)
knitr::opts_knit$set(root.dir = "C:/Users/timbv/Dropbox/Documents/Work/670G Combined")
library(Hmisc)
library(arsenal)
library(skimr)
library(mice)
library(nlme)
library(emmeans)
library(knitr)
library(tidyverse)
```

```{r data import and clean,include=FALSE}
na_strings <- c("","999","-999","NULL"," ")
# Kaan's data
# Read in
adult_demographics <- read.csv("./Data_Cleaned/adult_demographics.csv",
                               na.strings = na_strings)
adult <- read.csv("./Data_Cleaned/670Excel.csv",na.strings = na_strings)
adult_2 <- read.csv("./Data_Cleaned/Data set 670 Master.csv",na.strings = na_strings)
adult_new <- read.csv("./Data_Cleaned/670Excel.new55patients.csv",
                      na.strings = na_strings)
adult_pump <- read.csv("./Data_Cleaned/pdf_summary.csv",
                       na.strings = na_strings)
# Format and combine
adult <- adult %>% select(Patient.ID,start.date,contains("HbA1C"))
adult_2 <- adult_2 %>% select(Patient.ID,start.date,Ethnicity,Insurance,contains("HbA1C"))
adult <- full_join(adult,adult_2)
adult_new <- adult_new %>% select(Patient.ID,start.date,Ethnicity,Insurance,contains("HbA1C"))
adult <- full_join(adult,adult_new) 
adult <- adult %>% select(Patient.ID,start.date,Ethnicity,Insurance,HbA1C.Baseline,everything())
# Get demographic data
adult <- adult %>% filter(!is.na(HbA1C.Baseline))
adult <- left_join(adult,adult_demographics,by = "Patient.ID")
adult$age <- 
  as.numeric(difftime(as.Date(adult$start.date,format = "%m/%d/%Y"),
                      as.Date(adult$DOB,format = "%m/%d/%Y"),units = "days")/365.25)
# Get pdf data
adult$last_name <- tolower(sapply(strsplit(adult$LastName," "),"[[",1))
adult$first_name <- tolower(sapply(strsplit(adult$FirstName," "),"[[",1))
adult <- adult %>% 
  pivot_longer(cols = contains("HbA1C"),
               names_to = c(".value","timepoint"),
               names_sep = "\\.")
adult <- left_join(adult,adult_pump,by = c("last_name", "first_name", "timepoint"))
adult <- adult %>% group_by(Patient.ID) %>% 
  mutate(hba1c_baseline = HbA1C[timepoint == "Baseline"],
         days_from_start = as.numeric(difftime(as.Date(cgm_start,format = "%m/%d/%Y"),
                                               as.Date(start.date,format = "%m/%d/%Y"),
                                               units = "days"))) %>% ungroup()
# Delete rows without PDF information
pdf_start <- which(colnames(adult)=="days_worn")
remove_rows <- which(rowSums(is.na(adult[,pdf_start:(pdf_start+19)]))==20 &
                       adult$timepoint != "Baseline")
adult <- adult[-c(remove_rows),]
# Combine am exit columns to match Cari's
adult$amexits = 
  rowSums(adult[,c(which(colnames(adult) == "no_calib_exit"):
                     which(colnames(adult) == "other_exit"))])
adult <- adult %>% 
  mutate(time_am = am_use,time_mm = manual,sensor_mean = avg_sensor,
         sensor_sd = sd_sensor,gmi = 3.31 + (sensor_mean * 0.02392),
         amexit_hyper = high_sg_exit/amexits,
         amexit_manual = user_disabled_exit/amexits,
         amexits_other = other_exit/amexits,
         amexits_day = amexits / days_worn,
         cohort = "Adult",hba1c = HbA1C,
         record_id = Patient.ID,race = Ethnicity,
         insurance = Insurance,sex = Gender)
# Re-level factors
adult$race <- as.factor(adult$race)
levels(adult$race) <- c("Non-white","Non-white","White","White","Non-white","Non-white","Non-white","More Than One Race","More Than One Race","Unknown / Not Reported")
adult$race <- as.character(adult$race)
adult$insurance <- as.factor(adult$insurance)
levels(adult$insurance) <- c("Other","Public","Private")
adult$insurance <- as.character(adult$insurance)
# Select columns
vars <- c("record_id","cohort","timepoint","days_from_start","age","sex","race",
          "insurance","hba1c_baseline","hba1c","gmi","time_am","time_mm",
          "sensor_wear","sensor_mean","sensor_sd","amexits","amexit_hyper",
          "amexit_manual","amexits_day","amexits_other")
adult <- adult %>%
  select(all_of(vars))
# Cari's data
source("C:/Users/timbv/Documents/GitHub/BDC-Code/Cari Berget/670G Combined/data_clean.r")
# Exclude non-670G and those who never started
data <- data[as.numeric(as.character(data$record_id)) < 116,]
never_started <- data %>% group_by(record_id) %>% 
  filter(gyl_timepoint.factor == "Baseline",is.na(automode_start)) %>% .$record_id
data <- data[!(data$record_id %in% never_started),]
# Format
data$cohort <- "Peds"
data$timepoint = 
  as.character(factor(data$gyl_timepoint,levels = 0:5,
                      labels = c("Baseline","M1","M3","M6","M9","M12")))
levels(data$demographics_sex.factor) = c("F","M")
# Age
data$age <- as.numeric(difftime(as.Date(data$automode_start,"%m/%d/%Y"),
                                as.Date(data$demographics_dob,"%m/%d/%Y"),
                                units = "days"))/365.25
# Baseline A1c
data <- data %>% filter(!is.na(timepoint)) %>% group_by(record_id) %>% 
  mutate(hba1c_baseline = hba1c[timepoint == "Baseline"],
         age = age[timepoint == "Baseline"]) %>% ungroup()
# Make, fill down and select columns
data <- data %>%
  fill(demographics_dob,demographics_insurance.factor,demographics_sex.factor,
       demographics_race.factor,automode_start) %>%
  mutate(race = demographics_race.factor,sex = as.character(demographics_sex.factor),
         insurance = demographics_insurance.factor,amexit_hyper = amexit_hyper / amexits,
         amexit_manual = amexit_manual / amexits,amexits_other = amexits_other / amexits,
         gmi = 3.31 + (sensor_mean * 0.02392),
         days_from_start = as.numeric(difftime(as.Date(date_visit,"%m/%d/%Y"),
                                               as.Date(automode_start,"%m/%d/%Y"),
                                               units = "days"))) %>%
  select(all_of(vars))
# Remove rows with no pump data
pdf_start <- which(colnames(data)=="time_am")
remove_rows <- which(rowSums(is.na(data[,pdf_start:(pdf_start+9)]))==10)
# One data frame
df = rbind(adult,data)
factor_vars = c("record_id","sex","race","insurance","cohort")
df[,factor_vars] <- lapply(df[,factor_vars], as.factor)
# Order timepoints
df$timepoint <- factor(df$timepoint,levels = c("Baseline","M1","M3","M6","M9","M12"))
# Create age and a1c groups
df$age_group <- cut(df$age,breaks = c(0,18,26,50,Inf),right = F)
levels(df$age_group) <- c("Pediatric","Young Adult","Adult","Older Adult")
df$hba1c_group <- cut(df$hba1c_baseline,breaks = c(0,7,8,Inf))
levels(df$hba1c_group) <- c("<= 7%","7% - 8.9%",">= 9%")
```

Pediatric participants with no automode start date and adult participants with no baseline HbA1c value were excluded from this analysis.

# Table 1: Descriptive Characteristics

```{r table 1,results='asis',message=FALSE}
demographics <- df %>% group_by(record_id) %>% filter(row_number()==1)
# Table 1
t1 <- tableby(cohort ~ hba1c_baseline + hba1c_group + age + age_group + sex + 
                race + insurance,data = demographics)
# Print
summary(t1,pfootnote = T,
        labelTranslations = list(age = "Age (years) at HCL Start",
                                 age_group = "Age Group at HCL Start",
                                 sex = "Sex",race = "Race",
                                 insurance = "Insurance",
                                 hba1c_baseline = "HbA1c (%) at Baseline"))
```

# Figure 1: HbA1c Over Time by Cohort

```{r warning=FALSE,message=FALSE}
ggplot(df,aes(x = timepoint,y = hba1c)) +
  geom_line(alpha = 0.2,aes(group = record_id,color = cohort)) +
  geom_smooth(aes(group = cohort,color = cohort),se = F) +
  theme_bw() + xlab("Timepoint") + ylab("HbA1c (%)")
```

# Figure 2: HbA1c Over Time by Age Group

```{r warning=FALSE,message=FALSE}
ggplot(df[!is.na(df$age_group),],aes(x = timepoint,y = hba1c)) +
  geom_line(alpha = 0.2,aes(group = record_id,color = age_group)) +
  geom_smooth(aes(group = age_group,color = age_group),se = F) +
  theme_bw() + xlab("Timepoint") + ylab("HbA1c (%)")
```

# Figure 3: GMI Over Time by Cohort

```{r warning=FALSE,message=FALSE}
ggplot(df,aes(x = timepoint,y = gmi)) +
  geom_line(alpha = 0.2,aes(group = record_id,color = cohort)) +
  geom_smooth(aes(group = cohort,color = cohort),se = F) +
  theme_bw() + xlab("Timepoint") + ylab("GMI")
```

# Figure 4: GMI Over Time by Age Group

```{r warning=FALSE,message=FALSE}
ggplot(df[!is.na(df$age_group),],aes(x = timepoint,y = gmi)) +
  geom_line(alpha = 0.2,aes(group = record_id,color = age_group)) +
  geom_smooth(aes(group = age_group,color = age_group),se = F) +
  theme_bw() + xlab("Timepoint") + ylab("GMI")
```

# Model Results

```{r contrasts}
# Peds
base_peds <- c(1,rep(0,23))
m1_peds <- c(rep(0,1),1,rep(0,22))
m3_peds <- c(rep(0,2),1,rep(0,21))
m6_peds <- c(rep(0,3),1,rep(0,20))
m9_peds <- c(rep(0,4),1,rep(0,19))
m12_peds <- c(rep(0,5),1,rep(0,18))
# YA
base_ya <- c(rep(0,6),1,rep(0,17))
m1_ya <- c(rep(0,7),1,rep(0,16))
m3_ya <- c(rep(0,8),1,rep(0,15))
m6_ya <- c(rep(0,9),1,rep(0,14))
m9_ya <- c(rep(0,10),1,rep(0,13))
m12_ya <- c(rep(0,11),1,rep(0,12))
# Adult
base_adult <- c(rep(0,12),1,rep(0,11))
m1_adult <- c(rep(0,13),1,rep(0,10))
m3_adult <- c(rep(0,14),1,rep(0,9))
m6_adult <- c(rep(0,15),1,rep(0,8))
m9_adult <- c(rep(0,16),1,rep(0,7))
m12_adult <- c(rep(0,17),1,rep(0,6))
# Older adult
base_older <- c(rep(0,18),1,rep(0,5))
m1_older <- c(rep(0,19),1,rep(0,4))
m3_older <- c(rep(0,20),1,rep(03))
m6_older <- c(rep(0,21),1,rep(0,2))
m9_older <- c(rep(0,22),1,rep(0,1))
m12_older <- c(rep(0,23),1)
```

```{r model function}
# Based on preliminary analyses, an AR1 model with random intercept is best for most variables.
ar1_mod_func <- function(outcome,outcome_label,data = df,
                         log_transform=F){
  if(log_transform==T){
    form <- as.formula(paste0("log(",outcome,")~","timepoint*age_group"))
  } else {
    form <- as.formula(paste0(outcome,"~","timepoint*age_group"))
  }
  # Try model with interaction
  mod <- lme(form,random = ~1|record_id,data=data,
             correlation=corAR1(),na.action = na.omit)
  ano <- as.data.frame(anova(mod))
  # If not significant, re-fit without it
  if(ano["timepoint:age_group","p-value"] >= 0.05){
    form <- update.formula(form,~timepoint+age_group)
    mod <- lme(form,random = ~1|record_id,data=data,
               correlation=corAR1(),na.action = na.omit)
    ano <- as.data.frame(anova(mod))
  }
  
  emm <- emmeans(mod,~timepoint*age_group)
  contrast(emm, 
           method = list("peds1 vs. peds3" = m1_peds - m3_peds))
}
```

## By Age Group at HCL Start

### HbA1c

HbA1c was log-transformed for normality. Interaction effects between timepoint and age group were not significant (p = 0.9368), and therefore not included in the final model.

```{r}
# Residuals look much better with HbA1c log transformed. AR1 model better by AIC.
hba1c_mod_ar1 <- lme(log(hba1c) ~ timepoint*age_group,random = ~1|record_id,df,
                     correlation=corAR1(),na.action = na.omit)
hba1c_mod <- lme(log(hba1c) ~ timepoint*age_group,random = ~1|record_id,df,
                 na.action = na.omit)
# No overall effect of the interaction term, so re-fit without it.
final_hba1c_mod <- lme(log(hba1c) ~ timepoint+age_group,random = ~1|record_id,df,
                       correlation=corAR1(),na.action = na.omit)
# Results
a <- anova(final_hba1c_mod)
rownames(a) <- c("(Intercept)","Timepoint","Age Group" )
kable(a,caption = "HbA1c by Timepoint and Age Group - Overall Effects")

res <- summary(final_hba1c_mod)$tTable
rownames(res) <- sub("timepoint*","",rownames(res))
rownames(res) <- sub("age_group*","",rownames(res))
kable(res,caption = "HbA1c by Timepoint and Age Group")
# Means
kable(emmeans(final_hba1c_mod,~timepoint*age_group),
      caption = "emmeans")
```

There was an overall effect of both time and age group on HbA1c. The "emmean" tables above are currently on the log scale, but I can transform them to regular HbA1c once we know what to report. I was assuming that the age group mean at each timepoint would be most useful.

### GMI

```{r}
# About the same by AIC, so use AR1 for consistency.
# Overall effect of the interaction term, so no need to re-fit .
gmi_mod_ar1 <- 
  lme(gmi ~ timepoint*age_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      correlation=corAR1(),na.action = na.omit)
gmi_mod <- 
  lme(gmi ~ timepoint*age_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      na.action = na.omit)
# Results
a <- anova(gmi_mod_ar1)
rownames(a) <- c("(Intercept)","Timepoint","Age Group","Timepoint:Age Group")
kable(a,caption = "GMI by Timepoint and Age Group - Overall Effects")

res <- as.data.frame(summary(gmi_mod_ar1)$tTable)
rownames(res) <- sub("timepoint*","",rownames(res))
rownames(res) <- sub("age_group*","",rownames(res))
kable(res,caption = "GMI by Timepoint and Age Group")
# Means
kable(emmeans(gmi_mod_ar1,~timepoint*age_group,
              data = df[df$timepoint != "Baseline",]),
      caption = "emmeans")
```

There were overall effects of timepoint, age group, and their interaction on GMI. The "emmeans" table shows the mean GMI for each age group at each timepoint. The "GMI by Timepoint and Age Group" table uses the pediatric group at M1 as the reference group, and everything else is in comparison to that group. So for example, the older adult group at month 3 was different by `r res$Value[which(rownames(res) == "M3:Older Adult")]` on average, and this difference was significant (p = `r res[which(rownames(res) == "M3:Older Adult"),"p-value"]`)

### Mean Sensor

```{r}
# About the same by AIC, so use AR1 for consistency.
# Overall effect of the interaction term, so no need to re-fit .
mean_mod_ar1 <- 
  lme(sensor_mean ~ timepoint*age_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      correlation=corAR1(),na.action = na.omit)
mean_mod <- 
  lme(sensor_mean ~ timepoint*age_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      na.action = na.omit)
# Results
a <- anova(mean_mod_ar1)
rownames(a) <- c("(Intercept)","Timepoint","Age Group","Timepoint:Age Group")
kable(a,caption = "Mean Sensor by Timepoint and Age Group - Overall Effects")

res <- as.data.frame(summary(mean_mod_ar1)$tTable)
rownames(res) <- sub("timepoint*","",rownames(res))
rownames(res) <- sub("age_group*","",rownames(res))
kable(res,caption = "Mean Sensor by Timepoint and Age Group")
# Means
kable(emmeans(mean_mod_ar1,~timepoint|age_group,
              data = df[df$timepoint != "Baseline",]),
      caption = "emmeans")
```

There were overall effects of timepoint and age group on average sensor, but their interaction was not significant. The "emmeans" table shows the mean sensor for each age group at each timepoint. The "Mean Sensor by Timepoint and Age Group" table uses the pediatric group at M1 as the reference group, and everything else is in comparison to that group.

### Time in AM

The residuals for this model are not great. Are there other variables we could include to see if they help the fit?

```{r}
# About the same by AIC, so use AR1 for consistency.
# Overall effect of the interaction term, so no need to re-fit .
am_mod_ar1 <- 
  lme(time_am ~ timepoint*age_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      correlation=corAR1(),na.action = na.omit)
am_mod <- 
  lme(time_am ~ timepoint*age_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      na.action = na.omit)
# Results
a <- anova(am_mod_ar1)
rownames(a) <- c("(Intercept)","Timepoint","Age Group","Timepoint:Age Group")
kable(a,caption = "Time in AM by Timepoint and Age Group - Overall Effects")

res <- as.data.frame(summary(am_mod_ar1)$tTable)
rownames(res) <- sub("timepoint*","",rownames(res))
rownames(res) <- sub("age_group*","",rownames(res))
kable(res,caption = "Time in AM by Timepoint and Age Group")
# Means
kable(emmeans(am_mod_ar1,~timepoint|age_group,
              data = df[df$timepoint != "Baseline",]),
      caption = "emmeans")
```

There were overall effects of timepoint, age group, and their interaction on time in AM. The "emmeans" table shows the mean time in AM for each age group at each timepoint. The "Time in AM by Timepoint and Age Group" table uses the pediatric group at M1 as the reference group, and everything else is in comparison to that group. So for example, the older adult group at month 3 was different by `r res$Value[which(rownames(res) == "M3:Older Adult")]` on average, and this difference was significant (p = `r res[which(rownames(res) == "M3:Older Adult"),"p-value"]`)

### AM Exits per Day

```{r}
# About the same by AIC, so use AR1 for consistency.
# Overall effect of the interaction term, so no need to re-fit .
amexits_mod_ar1 <- 
  lme(amexits_day ~ timepoint*age_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      correlation=corAR1(),na.action = na.omit)
amexits_mod <- 
  lme(amexits_day ~ timepoint*age_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      na.action = na.omit)
# No overall effect of timepoint or interaction, so re-fit
amexits_mod_ar1 <- 
  lme(amexits_day ~ age_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      correlation=corAR1(),na.action = na.omit)
# Results
a <- anova(amexits_mod_ar1)
rownames(a) <- c("(Intercept)","Age Group")
kable(a,caption = "Time in AM by Age Group - Overall Effects")

res <- as.data.frame(summary(amexits_mod_ar1)$tTable)
rownames(res) <- sub("age_group*","",rownames(res))
kable(res,caption = "AM Exits per Day by Age Group")
# Means
kable(emmeans(amexits_mod_ar1,~age_group,
              data = df[df$timepoint != "Baseline",]),
      caption = "emmeans")
```

There were no overall effects of timepoint on AM exits per day. The "emmeans" table shows the mean AM exits per day for each age group. The "Time in AM by Age Group" table uses the pediatric group as the reference group, and everything else is in comparison to that group. So for example, the older adult group was different by `r res$Value[which(rownames(res) == "Older Adult")]` on average, and this difference was significant (p = `r res[which(rownames(res) == "Older Adult"),"p-value"]`)

## By Baseline HbA1c Group

Does it make sense to look at GMI by HbA1c group when GMI and HbA1c are highly correlated? 

### Mean Sensor

```{r}
# Residuals look much better with HbA1c log transformed. 
# Same by AIC, so use AR1 for consistency.
# Overall effect of the interaction term, so no need to re-fit .
mean_mod_ar1 <- 
  lme(sensor_mean ~ timepoint*hba1c_group,random = ~1|record_id,df,
      correlation=corAR1(),na.action = na.omit)
mean_mod <- 
  lme(sensor_mean ~ timepoint*hba1c_group,random = ~1|record_id,df,
      na.action = na.omit)
# No overall effect of the interaction term, so re-fit without it.
final_mean_mod <- lme(sensor_mean ~ timepoint+hba1c_group,random = ~1|record_id,df,
                      correlation=corAR1(),na.action = na.omit)
# Results
a <- anova(final_mean_mod)
rownames(a) <- c("(Intercept)","Timepoint","HbA1c Group")
kable(a,caption = "Mean Sensor by Timepoint and HbA1c Group - Overall Effects")

res <- as.data.frame(summary(final_mean_mod)$tTable)
rownames(res) <- sub("timepoint*","",rownames(res))
rownames(res) <- sub("hba1c_group*","HbA1c ",rownames(res))
kable(res,caption = "Mean Sensor by Timepoint and Age Group")
# Means
kable(emmeans(final_mean_mod,~timepoint),
      caption = "emmeans")
kable(emmeans(final_mean_mod,~hba1c_group),
      caption = "emmeans")
```

There were overall effects of timepoint and HbA1c group on average sensor, but their interaction was not significant. The "emmeans" table shows the mean sensor for each HbA1c group and each timepoint. The "Mean Sensor by Timepoint and HbA1c Group" table uses the low HbA1c group at baseline as the reference group, and everything else is in comparison to that group.

### Time in AM

The residuals for this model are not great either. Are there other variables we could include to see if they help the fit?

```{r}
# AR1 better by AIC, so use AR1 for consistency.
# Overall effect of the interaction term, so no need to re-fit .
am_mod_ar1 <- 
  lme(time_am ~ timepoint*hba1c_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      correlation=corAR1(),na.action = na.omit)
am_mod <- 
  lme(time_am ~ timepoint*hba1c_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      na.action = na.omit)
# Results
a <- anova(am_mod_ar1)
rownames(a) <- c("(Intercept)","Timepoint","HbA1c Group","Timepoint:HbA1c Group")
kable(a,caption = "Time in AM by Timepoint and HbA1c Group - Overall Effects")

res <- as.data.frame(summary(am_mod_ar1)$tTable)
rownames(res) <- sub("timepoint*","",rownames(res))
rownames(res) <- sub("hba1c_group*","HbA1c ",rownames(res))
kable(res,caption = "Time in AM by Timepoint and Age Group")
# Means
kable(emmeans(am_mod_ar1,~timepoint|hba1c_group,
              data = df[df$timepoint != "Baseline",]),
      caption = "emmeans")
```

There were overall effects of timepoint, HbA1c group, and their interaction on time in AM. The "emmeans" table shows the mean time in AM for each group at each timepoint. The "Time in AM by Timepoint and HbA1c Group" table uses the pediatric group at M1 as the reference group, and everything else is in comparison to that group. So for example, the high HbA1c group at month 6 was different by `r res$Value[which(rownames(res) == "M6:HbA1c >= 9%")]` on average, and this difference was significant (p = `r res[which(rownames(res) == "M6:HbA1c >= 9%"),"p-value"]`)

### AM Exits per Day

```{r}
# About the same by AIC, so use AR1 for consistency.
# Overall effect of the interaction term, so no need to re-fit .
amexits_mod_ar1 <- 
  lme(amexits_day ~ timepoint*hba1c_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      correlation=corAR1(),na.action = na.omit)
amexits_mod <- 
  lme(amexits_day ~ timepoint*hba1c_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      na.action = na.omit)
# No overall effect of timepoint or interaction, so re-fit
amexits_mod_ar1 <- 
  lme(amexits_day ~ hba1c_group,random = ~1|record_id,df[df$timepoint != "Baseline",],
      correlation=corAR1(),na.action = na.omit)
# Results
a <- anova(amexits_mod_ar1)
rownames(a) <- c("(Intercept)","HbA1c Group")
kable(a,caption = "Time in AM by HbA1c Group - Overall Effects")

res <- as.data.frame(summary(amexits_mod_ar1)$tTable)
rownames(res) <- sub("hba1c_group*","HbA1c ",rownames(res))
kable(res,caption = "AM Exits per Day by HbA1c Group")
# Means
kable(emmeans(amexits_mod_ar1,~hba1c_group,
              data = df[df$timepoint != "Baseline",]),
      caption = "emmeans")
```

There were no overall effects of timepoint on AM exits per day. The "emmeans" table shows the mean AM exits per day for each HbA1c group. The "Time in AM by HbA1c Group" table uses the low HbA1c group as the reference, and everything else is in comparison to that group. So for example, the high HbA1c group was different by `r res$Value[which(rownames(res) == "HbA1c >= 9%")]` on average, and this difference was significant (p = `r res[which(rownames(res) == "HbA1c >= 9%"),"p-value"]`)

# Questions/Notes

1. Some of the later participants in the peds cohort don't have an AM start date in REDCap, so they were counted as never started. Is that correct?

2. Some of the PDFs appear to be the wrong dates for Kaan's group. Should we just exclude any that are from prior to the given start date?