---
title: "670G Obs. ATTD 2019"
author: "Tim Vigers & Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "/Volumes/som/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects")
library(tableone)
library(skimr)
library(knitr)
library(tidyverse)
```

```{r data import and formatting,echo=FALSE,include=FALSE}
# Import
source("./Cari Berget/ATTD Abstract 2019/Data_Cleaned/AdvancedClosedLoopCl_R_2019-09-30_1049.r")
# A1c as numeric
data$hba1c <- as.numeric(as.character(data$hba1c))
data$hba1c_baseline <- as.numeric(as.character(data$hba1c_baseline))
# Subjects who withdrew (per Cari)
withdrawn <- c("41","50")
# Demographics
demographics <- data %>% 
  filter(redcap_event_name %in% c("baseline_arm_1","baseline_arm_2"),
         !is.na(automode_start),!(record_id %in% withdrawn)) %>%
  select(record_id,demographics_dob,demographics_diabetesdx,automode_start,hba1c_date_b,
         hba1c_baseline,demographics_sex.factor,demographics_race.factor,demographics_ethnicity.factor,
         demographics_insurance.factor,demographics_cgmhx.factor,demographics_pumphx.factor) %>%
  mutate(age_at_am_start = round(as.numeric((difftime(automode_start,demographics_dob,units = "days"))/365.25),2),
         t1d_duration_at_am_start = round(as.numeric((difftime(automode_start,demographics_diabetesdx,units = "days"))/365.25),2))
```

```{r table 1,echo=FALSE}
cont_vars <- c("hba1c_baseline","age_at_am_start","t1d_duration_at_am_start")
cat_vars <- c("demographics_sex.factor","demographics_race.factor","demographics_ethnicity.factor",
              "demographics_insurance.factor","demographics_cgmhx.factor","demographics_pumphx.factor")
nonnormal <- c("t1d_duration_at_am_start") # A1c always reported as mean (SD)
t1 <- CreateTableOne(vars = c(cont_vars,cat_vars),data = demographics)
t1 <- print(t1,nonnormal = nonnormal,printToggle = F)
kable(t1)
```