---
title: "GWAS"
author: "Tim Vigers & Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "/media/tim/Work/Kimber Simmons/GWAS")
library(tidyverse)
```

### PCA

```{r echo=FALSE,warning=FALSE}
# Read in race info for study participants
kimber = read.csv("./Data_Cleaned/clinical.csv")
# Match to .fam IDs
fam = read.table(file="./Data_Cleaned/plink/tgp_merged.fam",header=F)
fam$studyid = gsub(".*_","",fam$V2)
fam$race = kimber$Hispanic..0.N..1.Y.[match(fam$studyid,kimber$correct_labID)]
biobank1 = read.csv("./Data_Raw/V2 - Biobank data on Hispanic Patients - Full Genetic Request/Table 1 Patient.csv")
biobank2 = read.csv("./Data_Raw/Simmons Biobank/Biobank Hispanic Patients - Compass Mapping File.csv")
fam$race[which(fam$studyid %in% biobank1$Arb_Person_ID)] = 
  biobank1$Ethnicity[match(fam$studyid[which(fam$studyid %in% biobank1$Arb_Person_ID)],biobank1$Arb_Person_ID)]
fam$race[which(fam$studyid %in% biobank2$Arb_person_id)] = 1
fam$race = ifelse(fam$race == 1,"Hispanic","Non-Hispanic")
fam$V1 = fam$V2
# Reference races
race = read.table(file="/media/tim/Work/TGP/phase3_corrected.psam",
                stringsAsFactors = F)
fam$superpop = NA
fam$superpop = race$V5[match(fam$V1,race$V1)]
fam$superpop = coalesce(fam$race,fam$superpop)
fam$race = fam$superpop
fam$race = factor(fam$race,labels = c("Non-Hispanic","Hispanic","Non-Hispanic",
                                      "Non-Hispanic","Hispanic","Non-Hispanic",
                                      "Non-Hispanic"))
# Import PCA
data = read.table(file="./Data_Cleaned/plink/PCA.eigenvec",header=FALSE)
colnames(data) = c("FID","IID",paste0("C",seq(1,ncol(data)-2)))

data$race = fam$race[match(data$IID,fam$V2)]
data$superpop = fam$superpop[match(data$IID,fam$V2)]
datafile = data[!is.na(data$superpop),]
# Plot (colorblind friendly)
cbPalette = c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
ggplot(datafile,aes(x=C1,y=C2)) + geom_point(aes(color = superpop)) + scale_color_manual(values=cbPalette) + theme_bw()
ggplot(datafile,aes(x=C2,y=C3)) + geom_point(aes(color = superpop)) + scale_color_manual(values=cbPalette) + theme_bw()
ggplot(datafile,aes(x=C1,y=C3)) + geom_point(aes(color = superpop)) + scale_color_manual(values=cbPalette) + theme_bw()
```

