---
title: "Hispanic PGRS"
author: "Tim Vigers & Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = "/Users/timvigers/Documents/OneDrive - The University of Colorado Denver/simmons")
library(arsenal)
library(skimr)
library(knitr)
library(tidyverse)
```

# PCA 

## By Cohort

There are clear batch effects between Kimber's data and the Biobank data. When PC3 is included in the logistic regression, the VIF for cohort is really high, suggesting that PC3 is primarily driven by batch. 

```{r}
PCA <- read.delim("./analysis/PCA.eigenvec")
colnames(PCA)[1] <- "FID"
# Get ethnicity
kimber <- read.csv("./clinical.csv")
biobank <- read.csv("./Biobank Hispanic Patients - Compass Mapping File.csv")
PCA$studyid <- gsub(".*_","",PCA$IID)
PCA$Ethnicity <- kimber$Hispanic..0.N..1.Y.[match(PCA$studyid,kimber$correct_labID)]
PCA$Ethnicity[is.na(match(PCA$studyid,kimber$correct_labID))] <- 1
PCA$Ethnicity <- factor(PCA$Ethnicity,levels = c(0,1),labels = c("Non-Hispanic","Hispanic"))
# Cohort info
PCA$Cohort <- ifelse(PCA$studyid %in% kimber$correct_labID,"Kimber","Biobank")
# Sex
PCA$Sex <- kimber$Gender[match(PCA$studyid,kimber$correct_labID)]
PCA$Sex[is.na(PCA$Sex)] <- biobank$Sex[match(PCA$studyid[is.na(PCA$Sex)],biobank$Arb_person_id)]
PCA$Sex <- as.factor(PCA$Sex)
levels(PCA$Sex) <- c("F", "F", "M", "M")
# Plot (colorblind friendly)
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
ggplot(PCA,aes(x=PC1,y=PC2)) + 
  geom_point(aes(color = Cohort)) + scale_color_manual(values=cbPalette) + theme_bw()
ggplot(PCA,aes(x=PC2,y=PC3)) + 
  geom_point(aes(color = Cohort)) + scale_color_manual(values=cbPalette) + theme_bw()
ggplot(PCA,aes(x=PC1,y=PC3)) + 
  geom_point(aes(color = Cohort)) + scale_color_manual(values=cbPalette) + theme_bw()
```

## By Ethnicity

Question for Nick/Laura: It doesn't look like Hispanic vs. non-Hispanic are separating well, does that mean that the first two PCs aren't really representing population structure? Would it be better to project these samples onto the 1000 Genomes data and then adjust for PCs?

```{r}
ggplot(PCA,aes(x=PC1,y=PC2)) + 
  geom_point(aes(color = Ethnicity)) + scale_color_manual(values=cbPalette) + theme_bw()
ggplot(PCA,aes(x=PC2,y=PC3)) + 
  geom_point(aes(color = Ethnicity)) + scale_color_manual(values=cbPalette) + theme_bw()
ggplot(PCA,aes(x=PC1,y=PC3)) + 
  geom_point(aes(color = Ethnicity)) + scale_color_manual(values=cbPalette) + theme_bw()
```

```{r}
# Make covariate txt file
write.table(PCA[,c("FID","IID","Sex","Ethnicity","PC1","PC2","PC3")],
            file = "./analysis/covar.txt",quote = F,row.names = F)
```

```{r}
logistic_results <- read.delim("./analysis/logistic_results.PHENO1.glm.logistic.hybrid")
adjusted_results <- read.delim("./analysis/logistic_results.adjusted")
```